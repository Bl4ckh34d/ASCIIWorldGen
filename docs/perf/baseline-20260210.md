# Baseline Perf Capture (2026-02-10)

Status: initial baseline scaffold captured and reproducible; full perf numbers pending.

Last refresh: 2026-02-13.

Godot:
- Version: `4.6.stable.mono.official.89cea1439`
- Renderer backend: `Vulkan 1.4.325 - Forward+`
- GPU: `NVIDIA GeForce RTX 3070 Ti Laptop GPU`
- RD availability: available in runtime smoke (`SMOKE_OK`).

Project settings:
- World resolution target: `275x62`
- Seed: terrain/hydro regression set `{1300716004, 7423911, 18924427}`; regional seam set `{1300716004, 7423911}`
- Time scale: regression script cadence (fixed scripted ticks; no UI time-scale slider)
- Active mode for this capture: shader/runtime smoke (`tools_smoke_society_tmp.gd`) + short runtime start (`--quit-after 2`)
- Portable runtime note: on this machine, GPU-only regression scripts require non-headless launch (`--headless` reports RD unavailable).

Scenario:
1. Launch runtime (`--path . --quit-after 2`) to verify startup.
2. Run society shader smoke (`-s res://tools_smoke_society_tmp.gd`).
3. Validate creation of compute pipelines for all society shaders.
4. Run regional cache micro-benchmark (`-s res://tools_regional_cache_perf.gd`).
5. Run regional redraw micro-benchmark (`-s res://tools_regional_redraw_perf.gd`).

Measurements (captured):
- RD available?: **yes**
- Society shader pipeline create success: **8/8** (`economy_tick`, `politics_tick`, `npc_tick`, `pop_migrate`, `trade_flow_tick`, `civilization_tick`, `wildlife_tick`, `society_overlay_pack`)
- Shader load/create logs: structured JSON events present via `Logger.gd`.
- Peak VRAM (estimate): **~3.71 MB minimum SSBO allocation footprint per terrain/hydro seed** (`66` alloc events / `3,887,724` bytes). This is a lower bound and excludes texture/pipeline/driver overhead.
- Total GPU buffers allocated (count/bytes):
  - Terrain/hydro regression (`tools_terrain_hydro_regression_gpu.out.txt`): **198 alloc events / 11,663,172 bytes total** across 3 seeds (avg **66 / 3,887,724 bytes** per seed).
  - Regional seam regression (`tools_regional_seam_regression.out.txt`): **116 alloc events / 7,502,072 bytes total** across 2 seeds (avg **58 / 3,751,036 bytes** per seed).
- Total readbacks (count/bytes): **0 / 0 observed** in emitted regression logs (terrain/hydro + regional seam runs).
- Frame time p50/p95/p99: not captured in current script-mode regressions; requires interactive runtime capture (Dev HUD / frame sampler).
- Climate shore pass time: not separately instrumented in current logs; pending a dedicated timing hook around climate-shore compute dispatch.
- Regional chunk-cache benchmark (`tools_regional_cache_perf.gd`, 275x62, `RENDER_W=68`, `RENDER_H=34`, `220` camera steps/seed):
  - Seed `1300716004`: prefetch avg **9.173 ms/step**, sample avg **16.204 ms/step**, generated chunks **48**, cache hit **99.99%** (`513,076` hits / `48` misses), cached chunks end **48/256**.
  - Seed `7423911`: prefetch avg **9.210 ms/step**, sample avg **16.160 ms/step**, generated chunks **48**, cache hit **99.99%** (`513,076` hits / `48` misses), cached chunks end **48/256**.
  - Aggregate (2 seeds): prefetch avg **9.192 ms/step**, sample avg **16.182 ms/step**, cache hit **99.99%** (`1,026,152` hits / `96` misses), total generated chunks **96**.
- Regional redraw benchmark (`tools_regional_redraw_perf.gd`, actual `RegionalMap` full vs incremental paths with partial GPU edge uploads, `220` redraw steps/seed):
  - Seed `1300716004`: full avg **39.509 ms/step**, incremental avg **11.276 ms/step**, speedup **3.50x**, fresh-cell reduction **98.00%**, incremental redraw p95 **2.033 ms**, incremental upload p95 **1.104 ms**, partial upload coverage **219/220**, incremental fallback **0**.
  - Seed `7423911`: full avg **39.662 ms/step**, incremental avg **11.282 ms/step**, speedup **3.52x**, fresh-cell reduction **98.00%**, incremental redraw p95 **2.038 ms**, incremental upload p95 **0.981 ms**, partial upload coverage **219/220**, incremental fallback **0**.
  - Aggregate (2 seeds): full avg **39.585 ms/step**, incremental avg **11.279 ms/step**, speedup **3.51x**, fresh-cell reduction **98.00%**, incremental redraw p95 **2.035 ms**, incremental upload p95 **1.043 ms**, partial upload coverage **438/440**, total incremental fallback **0**.

Notes:
- This baseline confirms GPU path health for the new society/civilization scaffolding and shader loader changes.
- Use `F3` dev HUD during interactive runs to capture alloc/readback counters and fold them into next baseline update.
- `F3` dev HUD now also reports regional redraw mode (`full`/`incremental`), delta direction, redraw cost, fresh/reused cell counts, GPU upload mode/cost (`partial`/`full`), and rolling redraw p50/p95/p99.

Regression snapshot (2026-02-13):
- `tools_terrain_hydro_regression_gpu.gd`: **PASS (3 seeds)**.
- `tools_regional_seam_regression.gd`: **PASS (2 seeds)** after baseline schema migration to safe 32-bit hex hash values (`docs/perf/regional_seam_baseline.json`).
- `tools_politics_event_regression.gd`: **PASS**.
- `tools_regional_cache_perf.gd`: **PASS (2 seeds)**.
- `tools_regional_redraw_perf.gd`: **PASS (2 seeds)**.
- Leak check from regression logs: no end-of-run leaked RID warnings observed in the latest terrain/regional runs.
